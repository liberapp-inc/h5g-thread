function randInt(){return globalRandom["int"]()}function rand01(){return globalRandom.f01()}function randF(t,e){return globalRandom.f(t,e)}function randI(t,e){return globalRandom.i(t,e)}function randBool(t){return void 0===t&&(t=.5),globalRandom.bool(t)}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(s,a){function n(t){try{l(o.next(t))}catch(e){a(e)}}function r(t){try{l(o["throw"](t))}catch(e){a(e)}}function l(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(n,r)}l((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(s)throw new TypeError("Generator is already executing.");for(;l;)try{if(s=1,a&&(n=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,a=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(n=l.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){l.label=i[1];break}if(6===i[0]&&l.label<n[1]){l.label=n[1],n=i;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(i);break}n[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(o){i=[6,o],a=0}finally{s=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,a,n,r,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},__assign=this&&this.__assign||Object.assign||function(t){for(var e,i=1,o=arguments.length;o>i;i++){e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},GameObject=function(){function t(){this.display=null,t.objects.push(this)}return Object.defineProperty(t.prototype,"X",{get:function(){return this.display.x},set:function(t){this.display.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Y",{get:function(){return this.display.y},set:function(t){this.display.y=t},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.baseDisplay=e,t.gameDisplay=new egret.DisplayObjectContainer,t.baseDisplay.addChild(t.gameDisplay)},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t._delete(),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t._delete(),!1})},t.prototype._delete=function(){this.onDestroy(),this.display&&(this.display.parent.removeChild(this.display),this.display=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var PhysicsObject=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(){if(this.display){var t=this.body,e=this.display;e.x=this.px,e.y=this.py,e.rotation=180*t.angle/Math.PI}this.fixedUpdate()},e.prepare=function(t){e.pixelPerMeter=t,e.meterPerPixel=1/t,e.width=e.pixelToMeter(Util.width),e.height=e.pixelToMeter(Util.height),e.world=new p2.World,e.world.gravity=[0,e.height*PHYSICS_GRAVITY_PER_H],e.world.defaultContactMaterial.friction=1,e.lastTime=Date.now(),e.deltaScale=1},e.progress=function(){var t=Date.now(),i=(t-this.lastTime)*this.deltaScale;this.lastTime=t,i>0&&e.world.step(1/60*this.deltaScale,i,4)},e.prototype._delete=function(){this.onDestroy(),this.body&&(e.world.removeBody(this.body),this.body.displays=[],this.body=null),this.display&&(GameObject.gameDisplay.removeChild(this.display),this.display=null)},e.pixelToMeter=function(t){return t*e.meterPerPixel},e.meterToPixel=function(t){return t*e.pixelPerMeter},e.prototype.m2p=function(t){return e.meterToPixel(t)},e.prototype.p2m=function(t){return e.pixelToMeter(t)},Object.defineProperty(e.prototype,"px",{get:function(){return e.meterToPixel(this.mx)},set:function(t){this.mx=e.pixelToMeter(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"py",{get:function(){return e.meterToPixel(this.my)},set:function(t){this.my=e.pixelToMeter(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mx",{get:function(){return this.body.position[0]},set:function(t){this.body.position[0]=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"my",{get:function(){return this.body.position[1]},set:function(t){this.body.position[1]=t},enumerable:!0,configurable:!0}),e.deltaScale=1,e}(GameObject);__reflect(PhysicsObject.prototype,"PhysicsObject");var PType;!function(t){t[t.Normal=0]="Normal",t[t.Up=1]="Up",t[t.Down=2]="Down",t[t.Open=3]="Open",t[t.Close=4]="Close",t[t.UC=5]="UC",t[t.DC=6]="DC",t[t.UD=7]="UD",t[t.DU=8]="DU",t[t.Narrow=9]="Narrow",t[t.Total=10]="Total"}(PType||(PType={}));var Pillar=function(t){function e(e,i,o,s,a,n,r){void 0===r&&(r=!0);var l=t.call(this)||this;return l.effect=!1,l.pass=!1,l.x=e,l.y=i,l.w=o,l.h=s,l.color=a,l.point=n,l.effect=r,l.setDisplay(e,i),l.setBody(e,i),l.display.rotation=180*l.body.angle/Math.PI,Camera2D.transform(l.display),l}return __extends(e,t),e.newPillar=function(t,i,o,s){var a=Util.w(PILLAR_WIDTH_PER_W),n=Util.w(GAME_AREA_H_PER_W),r=Util.w(Util.lerp(PILLAR_HOLE_MAX_PW,PILLAR_HOLE_MIN_PW,s))*Player.speedCo,l=.5*(r+n),h=new e(t,i-l,a,n,Game.oColor(),10),p=new e(t,i+l,a,n,Game.oColor(),0),c=Util.w(.25),y=1e3/Player.speedCo;switch(o){case PType.Normal:break;case PType.Up:egret.Tween.get(h,{loop:!1}).to({y:h.y-c},y),egret.Tween.get(p,{loop:!1}).to({y:p.y-c},y);break;case PType.Down:egret.Tween.get(h,{loop:!1}).to({y:h.y+c},y),egret.Tween.get(p,{loop:!1}).to({y:p.y+c},y);break;case PType.Open:egret.Tween.get(h,{loop:!1}).to({y:h.y+c},0).to({y:h.y-0},y),egret.Tween.get(p,{loop:!1}).to({y:p.y-c},0).to({y:p.y-0},y);break;case PType.Close:egret.Tween.get(h,{loop:!1}).to({y:h.y-c},0).to({y:h.y-0},y),egret.Tween.get(p,{loop:!1}).to({y:p.y+c},0).to({y:p.y+0},y);break;case PType.UC:egret.Tween.get(h,{loop:!1}).to({y:h.y-c},.75*y),egret.Tween.get(p,{loop:!1}).to({y:p.y-c},1.5*y);break;case PType.DC:egret.Tween.get(h,{loop:!1}).to({y:h.y+c},1.5*y),egret.Tween.get(p,{loop:!1}).to({y:p.y+c},.75*y);break;case PType.UD:egret.Tween.get(h,{loop:!0}).to({y:h.y-c},y).to({y:h.y+0},y),egret.Tween.get(p,{loop:!0}).to({y:p.y-c},y).to({y:p.y+0},y);break;case PType.DU:egret.Tween.get(h,{loop:!0}).to({y:h.y+c},y).to({y:h.y+0},y),egret.Tween.get(p,{loop:!0}).to({y:p.y+c},y).to({y:p.y+0},y);break;case PType.Narrow:egret.Tween.get(h,{loop:!1}).to({y:h.y+r/5},0),egret.Tween.get(p,{loop:!1}).to({y:p.y-r/5},0)}},e.prototype.setDisplay=function(t,e){this.display&&GameObject.gameDisplay.removeChild(this.display);var i=new egret.Shape;this.display=i,GameObject.gameDisplay.addChildAt(this.display,1),i.x=t,i.y=e,i.graphics.beginFill(this.color),i.graphics.drawRect(-.5*this.w,-.5*this.h,this.w,this.h),i.graphics.endFill()},e.prototype.setBody=function(t,e){this.body=new p2.Body({gravityScale:0,mass:1,position:[this.p2m(t),this.p2m(e)],type:p2.Body.STATIC}),this.body.addShape(new p2.Box({width:this.p2m(this.w),height:this.p2m(this.h),collisionGroup:PHYSICS_GROUP_OBSTACLE,collisionMask:PHYSICS_GROUP_PLAYER}),[0,0],0),this.body.displays=[this.display],PhysicsObject.world.addBody(this.body)},e.prototype.update=function(){this.fixedUpdate()},e.prototype.fixedUpdate=function(){this.display.x=this.px=this.x,this.display.y=this.py=this.y,Camera2D.transform(this.display),0==this.pass&&this.x<Player.I.x&&(this.pass=!0,Score.I.addPoint(this.point),egret.Tween.removeTweens(this),this.effect&&new EffectFrame(this.X,this.Y,this.w,this.h,EFFECT_COLOR,-Player.I.vx,0)),this.display.x+this.w<0&&this.destroy()},e}(PhysicsObject);__reflect(Pillar.prototype,"Pillar");var Wave=function(t){function e(i){var o=t.call(this)||this;if(o.count=0,o.goalCount=0,o.modeCount=0,o.endInterval=2,o.state=o.stateNone,o.angled=!1,e.hardRate=0,Cave.prevPy0=Util.h(.5)-Util.w(.3*GAME_AREA_H_PER_W),Cave.prevPy1=Util.h(.5)+Util.w(.3*GAME_AREA_H_PER_W),o.level=i,o.waveX=Util.w(1),Player.speedCo=1,0==i)o.rand=new Random,o.setStatePillar();else{var s=i;i<e.levelSeeds.length&&0!=e.levelSeeds[i]&&(s=e.levelSeeds[i]),o.rand=new Random(573*s+765),o.rand["int"](),o.count=2*i,o.goalCount=12+i/4}return o}return __extends(e,t),e.prototype.update=function(){if(Player.I.state!=Player.I.stateNone&&Player.I.x+Util.w(2/3)>=this.waveX){if(this.count++,this.modeCount--,this.level>0&&(this.goalCount--,this.goalCount<=3))return this.waveX+=Util.w(PILLAR_INTER_PER_W),void(this.goalCount<=0&&(new GameOver(!0),PhysicsObject.deltaScale=0,egret.Tween.removeAllTweens(),this.setStateNone(),Player.I.setStateNone()));if(this.modeCount<=0){if(this.endInterval>0)return this.waveX+=Util.w(PILLAR_INTER_PER_W)*this.endInterval,void(this.endInterval=0);e.hardRate=Util.clamp(this.count/200,0,1),this.rand.bool(.5)&&Player.speedCo<=1&&this.state!=this.stateNone?(Player.speedCo=Util.lerp(MIN_SPEED_CO,MAX_SPEED_CO,e.hardRate),e.hardRate=Util.clamp(e.hardRate-.25,0,1)):Player.speedCo=1;var t=Math.floor(Util.lerp(3,5,this.count/10)),i=this.rand.i(0,t+1);switch(i){case 0:this.setStatePillar();break;case 1:this.setStateCave();break;case 2:this.setStateBall();break;case 3:this.setStateBox();break;case 4:this.setStateSlopeBox();break;case 5:this.setStatePillar(1);break;default:console.error("wave error"+i)}}this.state()}},e.prototype.setStateNone=function(){this.state=this.stateNone},e.prototype.stateNone=function(){},e.prototype.setStatePillar=function(t){void 0===t&&(t=0),this.state=this.statePillar,this.endInterval=2,Player.speedCo<=1?this.modeCount=this.rand.i(4,16):this.modeCount=4,0!=t?(PillarAngle.updateAngle(),this.angled=!0):this.angled=!1},e.prototype.statePillar=function(){this.newPillar()},e.prototype.newPillar=function(t){void 0===t&&(t=.3);var i=this.waveX,o=Util.h(.5)+Util.w(this.rand.f(-t,+t)*Util.lerp(.5,1,e.hardRate)),s=PType.Normal;this.rand.bool(.8*e.hardRate)&&(s=this.rand.i(PType.Normal,PType.Total)),0==this.angled?Pillar.newPillar(i,o,s,e.hardRate):PillarAngle.newPillar(i,o,s,e.hardRate);var a=Util.w(PILLAR_INTER_PER_W);this.waveX+=a,this.rand.bool(.25)&&new Coin(i+.5*a,o)},e.prototype.setStateCave=function(){this.state=this.stateCave,this.endInterval=3,Player.speedCo<=1?this.modeCount=this.rand.i(2,8):this.modeCount=2},e.prototype.stateCave=function(){this.newCave()},e.prototype.newCave=function(t){void 0===t&&(t=.45);var i=this.waveX,o=Util.h(.5)+Util.w(this.rand.f(-t,+t)*Util.lerp(.5,1,e.hardRate));Cave.newCave(i,o,e.hardRate,this.rand.f(.8,1.2));var s=Util.w(PILLAR_INTER_PER_W);this.waveX+=2*s,this.rand.bool(.25)&&new Coin(i+1.5*s,o)},e.prototype.setStateBall=function(){this.state=this.stateBall,this.endInterval=3,Player.speedCo<=1?this.modeCount=this.rand.i(4,16):this.modeCount=4},e.prototype.stateBall=function(){this.newBall()},e.prototype.newBall=function(){var t=this.waveX;if(this.rand.bool()?Ball.newBall(t,e.hardRate,1,this.rand,2):Ball.newBall(t,e.hardRate,0,this.rand,4),this.waveX+=Util.w(PILLAR_INTER_PER_W),this.rand.bool(.25)){var i=Util.h(.5)+Util.w(GAME_AREA_H_PER_W*this.rand.f(-.4,.4));new Coin(t,i)}},e.prototype.setStateBox=function(){this.state=this.stateBox,this.endInterval=3,Player.speedCo<=1?this.modeCount=this.rand.i(4,16):this.modeCount=4},e.prototype.stateBox=function(){this.newBox()},e.prototype.newBox=function(){var t=this.waveX;if(this.rand.bool()?Box.newBox(t,e.hardRate,1,this.rand,2):Box.newBox(t,e.hardRate,0,this.rand,5),this.waveX+=Util.w(PILLAR_INTER_PER_W),this.rand.bool(.25)){var i=Util.h(.5)+Util.w(GAME_AREA_H_PER_W*this.rand.f(-.4,.4));new Coin(t,i)}},e.prototype.setStateSlopeBox=function(){this.state=this.stateSlopeBox,this.endInterval=3,Player.speedCo<=1?this.modeCount=this.rand.i(4,16):this.modeCount=4},e.prototype.stateSlopeBox=function(){this.newSlopeBox()},e.prototype.newSlopeBox=function(){var t,i=Util.w(PILLAR_INTER_PER_W),o=this.waveX+1.5*i,s=Util.h(.5),a=.5*Util.w(GAME_AREA_H_PER_W),n=Util.lerp(Util.w(SLOPE_MIN_SIZE_PER_W),Util.w(SLOPE_MAX_SIZE_PER_W),e.hardRate*randF(.7,1));t=this.modeCount%2==0?-1:1;var r=s+a*t;new BoxSlope(o,r,n,Game.oColor(),10),this.rand.bool(.25)&&new Coin(o+randF(-1,1),r+1*-t),this.waveX+=i},e.levelSeeds=[0,1,2,3,4,5,6,7,8,9,10],e}(GameObject);__reflect(Wave.prototype,"Wave");var BackGround=function(t){function e(){var e=t.call(this)||this;return e.setShape(),document.body.style.background="#"+("000000"+Game.bColor().toString(16).toUpperCase()).substr(-6),e}return __extends(e,t),e.prototype.setShape=function(){var t=new egret.Shape;this.display&&GameObject.gameDisplay.removeChild(this.display),this.display=t,GameObject.gameDisplay.addChild(this.display),t.graphics.beginFill(Game.oColor(),1),t.graphics.drawRect(0,0,Util.width,Util.h(.5)-Util.w(.5*GAME_AREA_H_PER_W)),t.graphics.drawRect(0,Util.h(.5)+Util.w(.5*GAME_AREA_H_PER_W),Util.width,Util.height),t.graphics.endFill()},e.prototype.update=function(){},e}(GameObject);__reflect(BackGround.prototype,"BackGround");var Ball=function(t){function e(e,i,o,s,a){var n=t.call(this)||this;return n.pass=!1,n.x=e,n.y=i,n.r=o,n.color=s,n.point=a,n.setDisplay(e,i),n.setBody(e,i),n.display.rotation=180*n.body.angle/Math.PI,Camera2D.transform(n.display),n}return __extends(e,t),e.newBall=function(t,i,o,s,a){void 0===a&&(a=2);var n=Util.w(PILLAR_INTER_PER_W),r=Util.w(BALL_MIN_RADIUS_PER_W),l=Util.w(BALL_MAX_RADIUS_PER_W);t+=l;for(var h=1500/Player.speedCo,p=0;a>p;p++){var c=Util.h(.5)+Util.w(GAME_AREA_H_PER_W*s.f(-.5,.5)),y=Util.lerp(r,l,s.f01()*o),d=new e(t+s.f(0,n),c,y,Game.oColor(),3);if(s.bool(.25*i)){var u=s.f(0,Math.PI),f=Util.w(.25)*Math.cos(u),_=Util.w(.25)*Math.sin(u);s.bool(.5*Wave.hardRate)?egret.Tween.get(d,{loop:!0}).to({y:d.y+_,x:d.x+f},h).to({y:d.y,x:d.x},h):s.bool()&&egret.Tween.get(d,{loop:!1}).to({y:d.y+_,x:d.x+f},h)}}},e.prototype.setDisplay=function(t,e){this.display&&GameObject.gameDisplay.removeChild(this.display);var i=new egret.Shape;this.display=i,GameObject.gameDisplay.addChildAt(this.display,1),i.x=t,i.y=e,i.graphics.beginFill(this.color),i.graphics.drawCircle(0,0,this.r),i.graphics.endFill()},e.prototype.setBody=function(t,e){this.body=new p2.Body({gravityScale:0,mass:1,position:[this.p2m(t),this.p2m(e)],type:p2.Body.STATIC}),this.body.addShape(new p2.Circle({radius:this.p2m(this.r),collisionGroup:PHYSICS_GROUP_OBSTACLE,collisionMask:PHYSICS_GROUP_PLAYER})),this.body.displays=[this.display],PhysicsObject.world.addBody(this.body)},e.prototype.update=function(){this.fixedUpdate()},e.prototype.fixedUpdate=function(){this.display.x=this.px=this.x,this.display.y=this.py=this.y,Camera2D.transform(this.display),0==this.pass&&this.x<Player.I.x&&(this.pass=!0,Score.I.addPoint(this.point),egret.Tween.removeTweens(this),new EffectCircle(this.X,this.Y,this.r,EFFECT_COLOR,-Player.I.vx,0)),this.display.x+this.r<0&&this.destroy()},e}(PhysicsObject);__reflect(Ball.prototype,"Ball");var Box=function(t){function e(e,i,o,s,a){var n=t.call(this)||this;return n.pass=!1,n.x=e,n.y=i,n.s=o,n.color=s,n.point=a,n.setDisplay(e,i),n.setBody(e,i),n.display.rotation=180*n.body.angle/Math.PI,Camera2D.transform(n.display),n}return __extends(e,t),e.newBox=function(t,i,o,s,a){void 0===a&&(a=2);var n=Util.w(PILLAR_INTER_PER_W),r=Util.w(BOX_MIN_SIZE_PER_W),l=Util.w(BOX_MAX_SIZE_PER_W);t+=l;for(var h=Util.w(.25),p=1500/Player.speedCo,c=0;a>c;c++){var y=Util.h(.5)+Util.w(GAME_AREA_H_PER_W*s.f(-.5,.5)),d=Util.lerp(r,l,s.f01()*o),u=new e(t+s.f(0,n),y,d,Game.oColor(),3);s.bool(.25*i)&&(s.bool(.5*Wave.hardRate)?y<Util.h(.5)?egret.Tween.get(u,{loop:!0}).to({y:u.y+h},p).to({y:u.y+0},p):egret.Tween.get(u,{loop:!0}).to({y:u.y-h},p).to({y:u.y+0},p):s.bool()?egret.Tween.get(u,{loop:!1}).to({y:u.y-h},p):egret.Tween.get(u,{loop:!1}).to({y:u.y+h},p))}},e.prototype.setDisplay=function(t,e){this.display&&GameObject.gameDisplay.removeChild(this.display);var i=new egret.Shape;this.display=i,GameObject.gameDisplay.addChildAt(this.display,1),i.x=t,i.y=e,i.graphics.beginFill(this.color),i.graphics.drawRect(-.5*this.s,-.5*this.s,this.s,this.s),i.graphics.endFill()},e.prototype.setBody=function(t,e){this.body=new p2.Body({gravityScale:0,mass:1,position:[this.p2m(t),this.p2m(e)],type:p2.Body.STATIC}),this.body.addShape(new p2.Box({width:this.p2m(this.s),height:this.p2m(this.s),collisionGroup:PHYSICS_GROUP_OBSTACLE,collisionMask:PHYSICS_GROUP_PLAYER}),[0,0],0),this.body.displays=[this.display],PhysicsObject.world.addBody(this.body)},e.prototype.update=function(){this.fixedUpdate()},e.prototype.fixedUpdate=function(){this.display.x=this.px=this.x,this.display.y=this.py=this.y,Camera2D.transform(this.display),0==this.pass&&this.x<Player.I.x&&(this.pass=!0,Score.I.addPoint(this.point),egret.Tween.removeTweens(this),new EffectFrame(this.X,this.Y,this.s,this.s,EFFECT_COLOR,-Player.I.vx,0)),this.display.x+this.s/2<0&&this.destroy()},e}(PhysicsObject);__reflect(Box.prototype,"Box");var BoxSlope=function(t){function e(e,i,o,s,a){var n=t.call(this)||this;return n.pass=!1,n.x=e,n.y=i,n.s=o,n.color=s,n.point=a,n.setDisplay(e,i),n.setBody(e,i),n.display.rotation=180*n.body.angle/Math.PI,Camera2D.transform(n.display),n}return __extends(e,t),e.prototype.setDisplay=function(t,e){this.display&&GameObject.gameDisplay.removeChild(this.display);var i=new egret.Shape;this.display=i,GameObject.gameDisplay.addChildAt(this.display,1),i.x=t,i.y=e,i.graphics.beginFill(this.color),i.graphics.drawRect(-.5*this.s,-.5*this.s,this.s,this.s),i.graphics.endFill()},e.prototype.setBody=function(t,e){this.body=new p2.Body({gravityScale:0,mass:1,position:[this.p2m(t),this.p2m(e)],angle:Math.PI/4,type:p2.Body.STATIC}),this.body.addShape(new p2.Box({width:this.p2m(this.s),height:this.p2m(this.s),collisionGroup:PHYSICS_GROUP_OBSTACLE,collisionMask:PHYSICS_GROUP_PLAYER}),[0,0],0),this.body.displays=[this.display],PhysicsObject.world.addBody(this.body)},e.prototype.update=function(){this.fixedUpdate()},e.prototype.fixedUpdate=function(){this.display.x=this.px=this.x,this.display.y=this.py=this.y,Camera2D.transform(this.display),0==this.pass&&this.x<Player.I.x&&(this.pass=!0,Score.I.addPoint(this.point),egret.Tween.removeTweens(this),new EffectFrame(this.X,this.Y,this.s,this.s,EFFECT_COLOR,-Player.I.vx,0).display.rotation=this.display.rotation),this.display.x+this.s/2*1.414<0&&this.destroy()},e}(PhysicsObject);__reflect(BoxSlope.prototype,"BoxSlope");var Cave=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.newCave=function(t,i,o,s){var a=Util.w(CAVE_WIDTH_PER_W),n=Util.w(GAME_AREA_H_PER_W),r=Util.w(Util.lerp(CAVE_HOLE_MAX_PW,CAVE_HOLE_MIN_PW,o))*s,l=.5*(r+n),h=i-l,p=i+l,c=Math.min(h,e.prevPy0),y=Math.max(p,e.prevPy1),d=Util.w(1/256),u=!1;new Pillar(t+.5*a,c,a+d,n,Game.oColor(),10,u),new Pillar(t+.5*a,y,a+d,n,Game.oColor(),0,u),new Pillar(t+1.5*a,h,a+d,n,Game.oColor(),10,u),new Pillar(t+1.5*a,p,a+d,n,Game.oColor(),0,u),e.prevPy0=h,e.prevPy1=p},e}(Pillar);__reflect(Cave.prototype,"Cave");var Coin=function(t){function e(e,i){var o=t.call(this)||this;return o.step=0,o.radius=Util.w(COIN_RADIUS_PER_W),o.setShape(e,i),o.setBody(e,i),o}return __extends(e,t),e.prototype.setShape=function(t,e){var i=this.display;null==this.display?(this.display=i=new egret.Shape,GameObject.gameDisplay.addChild(this.display)):i.graphics.clear(),i.x=t,i.y=e,i.graphics.beginFill(COIN_COLOR),i.graphics.drawCircle(0,0,this.radius),i.graphics.endFill()},e.prototype.setBody=function(t,e){this.body=new p2.Body({gravityScale:0,mass:.1,position:[this.p2m(t),this.p2m(e)]}),this.body.addShape(new p2.Circle({radius:this.p2m(3*this.radius),collisionGroup:PHYSICS_GROUP_PLAYER,collisionMask:PHYSICS_GROUP_OBSTACLE})),this.body.displays=[this.display],PhysicsObject.world.addBody(this.body)},e.prototype.fixedUpdate=function(){this.body.velocity[0]*=.1,this.body.velocity[1]*=.1;var t=Util.h(.5),e=Util.w(.45*GAME_AREA_H_PER_W);this.py=Util.clamp(this.py,t-e,t+e),Camera2D.transform(this.display),this.isPicked()||this.isOutOfScreen()},e.prototype.isPicked=function(){var t=Player.I.x-this.px,e=Player.I.y-this.py,i=Math.pow(t,2)+Math.pow(e,2);if(i<=Math.pow(Player.I.radius+4*this.radius,2)){Score.I.addCombo();var o=10*Score.I.combo;return Score.I.addPoint(o),new EffectPopText("+"+o,this.display.x,this.display.y,30,COIN_COLOR),new EffectCircle(this.X,this.Y,2*this.radius,COIN_COLOR,-Player.I.vx,0),this.destroy(),!0}return!1},e.prototype.isOutOfScreen=function(){return 0==this.step&&this.px+3*this.radius<Player.I.x-Player.I.radius&&(this.step=1,Score.I.resetCombo(),new EffectPopText("MISS!",this.display.x,this.display.y,30,COIN_COLOR)),this.px+this.radius<=Camera2D.x?(this.destroy(),!0):!1},e}(PhysicsObject);__reflect(Coin.prototype,"Coin");var SaveKeyBestScore="thread-bestScore",DefaultBestScore=10,PIXEL_PER_METER=1,GAME_AREA_H_PER_W=1.2,THREAD_WIDTH_PER_W=1/256,PLAYER_SPEED_PER_W=1/180,RISE_POWER_PER_W=5e-4,MAX_SPEED_CO=2,MIN_SPEED_CO=1.4,PILLAR_WIDTH_PER_W=1/32,PILLAR_INTER_PER_W=.5,PILLAR_HOLE_MAX_PW=.25,PILLAR_HOLE_MIN_PW=.13,CAVE_WIDTH_PER_W=.5,CAVE_INTER_PER_W=2*CAVE_WIDTH_PER_W,CAVE_HOLE_MAX_PW=.3,CAVE_HOLE_MIN_PW=.13,BALL_MIN_RADIUS_PER_W=1/24,BALL_MAX_RADIUS_PER_W=.2,BOX_MIN_SIZE_PER_W=1/16,BOX_MAX_SIZE_PER_W=1/3,SLOPE_MIN_SIZE_PER_W=.8,SLOPE_MAX_SIZE_PER_W=1.06,COIN_RADIUS_PER_W=1/64,PHYSICS_GROUP_PLAYER=2,PHYSICS_GROUP_OBSTACLE=4,PHYSICS_GRAVITY_PER_H=0,PLAYER_COLOR=14737632,FONT_COLOR=16777215,FONT_COLOR2=3158064,COIN_COLOR=16744703,EFFECT_COLOR=16777215,BackColors=[3158064,2636512,12463439,4406848,3028090,3032392],WallColors=[12632256,15583815,6870186,11047530,13740636,11779750],Game=function(){function t(){}return t.bColor=function(){return BackColors[t.level%BackColors.length]},t.oColor=function(){return WallColors[t.level%WallColors.length]},t.level=0,t}();__reflect(Game.prototype,"Game");var SDK=!0,Muteki=!1,Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return Util.initial(this),GameObject.initial(this.stage),PhysicsObject.prepare(PIXEL_PER_METER),Camera2D.initial(),SDK?[4,Social.init()]:[3,2];case 1:t.sent(),t.label=2;case 2:return SceneTitle.loadScene(),egret.startTick(this.tickLoop,this),[2]}})})},e.prototype.tickLoop=function(t){return PhysicsObject.progress(),GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var PillarAngle=function(t){function e(i,o,s,a,n,r,l){void 0===l&&(l=!0);var h=t.call(this,i,o,s,a,n,r,l)||this;return h.body.angle=e.angle,h.display.rotation=180*h.body.angle/Math.PI,Camera2D.transform(h.display),h}return __extends(e,t),e.updateAngle=function(){var t=2;this.angle=randI(-t,+t),this.angle>=0&&this.angle++,this.angle=this.angle/2*Math.PI/6},e.newPillar=function(t,i,o,s){t+=Util.w(PILLAR_INTER_PER_W);var a=+Math.sin(e.angle),n=-Math.cos(e.angle),r=Util.w(PILLAR_WIDTH_PER_W),l=Util.w(GAME_AREA_H_PER_W),h=Util.w(Util.lerp(PILLAR_HOLE_MAX_PW,PILLAR_HOLE_MIN_PW,s))*Player.speedCo,p=.5*(h+l)*a,c=.5*(h+l)*n,y=new e(t-p,i-c,r,l,Game.oColor(),5),d=new e(t+p,i+c,r,l,Game.oColor(),5),u=Util.w(.25)*a,f=Util.w(.25)*n,_=1e3/Player.speedCo;switch(o){case PType.Normal:break;case PType.Up:egret.Tween.get(y,{loop:!1}).to({x:y.x-u,y:y.y-f},_),egret.Tween.get(d,{loop:!1}).to({x:d.x-u,y:d.y-f},_);break;case PType.Down:egret.Tween.get(y,{loop:!1}).to({x:y.x+u,y:y.y+f},_),egret.Tween.get(d,{loop:!1}).to({x:d.x+u,y:d.y+f},_);break;case PType.Open:egret.Tween.get(y,{loop:!1}).to({x:y.x+u,y:y.y+f},0).to({x:y.x-0,y:y.y-0},_),egret.Tween.get(d,{loop:!1}).to({x:d.x-u,y:d.y-f},0).to({x:d.x-0,y:d.y-0},_);break;case PType.Close:egret.Tween.get(y,{loop:!1}).to({x:y.x-u,y:y.y-f},0).to({x:y.x-0,y:y.y-0},_),egret.Tween.get(d,{loop:!1}).to({x:d.x+u,y:d.y+f},0).to({x:d.x+0,y:d.y+0},_);break;case PType.UC:egret.Tween.get(y,{loop:!1}).to({x:y.x-u,y:y.y-f},.75*_),egret.Tween.get(d,{loop:!1}).to({x:d.x-u,y:d.y-f},1.5*_);break;case PType.DC:egret.Tween.get(y,{loop:!1}).to({x:y.x+u,y:y.y+f},1.5*_),egret.Tween.get(d,{loop:!1}).to({x:d.x+u,y:d.y+f},.75*_);break;case PType.UD:egret.Tween.get(y,{loop:!0}).to({x:y.x-u,y:y.y-f},_).to({x:y.x+0,y:y.y+0},_),egret.Tween.get(d,{loop:!0}).to({x:d.x-u,y:d.y-f},_).to({x:d.x+0,y:d.y+0},_);break;case PType.DU:egret.Tween.get(y,{loop:!0}).to({x:y.x+u,y:y.y+f},_).to({x:y.x+0,y:y.y+0},_),egret.Tween.get(d,{loop:!0}).to({x:d.x+u,y:d.y+f},_).to({x:d.x+0,y:d.y+0},_);break;case PType.Narrow:var g=h/5*a,x=h/5*n;egret.Tween.get(y,{loop:!1}).to({x:y.x+g,y:y.y+x},0),egret.Tween.get(d,{loop:!1}).to({x:d.x-g,y:d.y-x},0)}},e.prototype.fixedUpdate=function(){if(this.display.x=this.px=this.x,this.display.y=this.py=this.y,Camera2D.transform(this.display),0==this.pass&&this.x<Player.I.x&&(this.pass=!0,Score.I.addPoint(this.point),this.effect)){var t=new EffectFrame(this.X,this.Y,this.w,this.h,EFFECT_COLOR,-Player.I.vx,0);t.display.rotation=this.display.rotation}this.display.x+Util.w(PILLAR_INTER_PER_W)<0&&this.destroy()},e.angle=0,e}(Pillar);__reflect(PillarAngle.prototype,"PillarAngle");var Player=function(t){function e(i,o){var s=t.call(this)||this;s.xyListMax=32,s.xyListStep=2,s.xyIndex=0,s.state=s.stateNone,e.I=s,s.radius=Util.w(THREAD_WIDTH_PER_W),s.x=i,s.y=o,s.vx=Util.w(PLAYER_SPEED_PER_W)*e.speedCo,s.vy=0,s.xyList=[];for(var a=0;a<s.xyListMax;a++)s.xyList[a]=[],s.xyList[a][0]=i-a*s.vx*s.xyListStep,s.xyList[a][1]=o;return s.scrollCamera(),s.setDisplay(i,o),s.setBody(i,o),s.button=new Button(null,0,0,.5,.5,1,1,0,0,-1,!1,null,null),s}return __extends(e,t),e.prototype.onDestroy=function(){this.button.destroy(),e.I=null},e.prototype.setDisplay=function(t,e){null==this.display&&(this.display=new egret.Shape,GameObject.gameDisplay.addChild(this.display));var i=this.display;i.graphics.clear(),this.xyIndex-=1/this.xyListStep,this.xyIndex<0&&(this.xyIndex+=this.xyListMax);var o=Math.floor(this.xyIndex);this.xyList[o][0]=t,this.xyList[o][1]=e,i.x=0,i.y=0,i.graphics.lineStyle(6,PLAYER_COLOR,1,!1,null,null,egret.JointStyle.MITER),i.graphics.moveTo(Camera2D.transX(this.xyList[o][0]),Camera2D.transY(this.xyList[o][1])),o=++o%this.xyListMax;for(var s=1;s<this.xyListMax;s++)i.graphics.lineTo(Camera2D.transX(this.xyList[o][0]),Camera2D.transY(this.xyList[o][1])),o=++o%this.xyListMax},e.prototype.setBody=function(t,e){this.body=new p2.Body({gravityScale:0,mass:.1,position:[this.p2m(t),this.p2m(e)]}),this.body.addShape(new p2.Circle({radius:this.p2m(this.radius),collisionGroup:PHYSICS_GROUP_PLAYER,collisionMask:PHYSICS_GROUP_OBSTACLE})),this.body.displays=[this.display],PhysicsObject.world.addBody(this.body),PhysicsObject.world.on("beginContact",this.beginContact,this)},e.prototype.beginContact=function(t){var e=t.bodyA,i=t.bodyB;(e==this.body||i==this.body)&&this.miss()},e.prototype.update=function(){this.fixedUpdate()},e.prototype.fixedUpdate=function(){this.state()},e.prototype.scrollCamera=function(){Camera2D.x=this.x-Util.w(1/3),Camera2D.y=0},e.prototype.setStateNone=function(){this.state=this.stateNone},e.prototype.stateNone=function(){},e.prototype.setStateMove=function(){this.state=this.stateMove},e.prototype.stateMove=function(){this.vx=Util.w(PLAYER_SPEED_PER_W)*e.speedCo,this.x+=this.vx;for(var t=e.speedCo;t>0;t-=1){var i=Util.clamp01(t),o=Math.pow(.97,i);this.vy*=o;var s=Util.w(RISE_POWER_PER_W)*i;this.vy+=this.button.touch?-s:+s,this.y+=this.vy*i}this.px=this.x,this.py=this.y,this.scrollCamera(),this.setDisplay(this.px,this.py),this.checkOut()},e.prototype.checkOut=function(){Math.pow(this.py-Util.h(.5),2)>Math.pow(Util.w(.5*GAME_AREA_H_PER_W),2)&&this.miss()},e.prototype.miss=function(){this.state!=this.stateNone&&(Muteki||(new GameOver(!1),PhysicsObject.deltaScale=.1,egret.Tween.removeAllTweens(),this.state=this.stateNone))},e.I=null,e.speedCo=1,e}(PhysicsObject);__reflect(Player.prototype,"Player");var EffectCircle=function(t){function e(e,i,o,s,a,n){void 0===a&&(a=0),void 0===n&&(n=0);var r=t.call(this)||this;return r.vx=0,r.vy=0,r.delta=.025,r.r=o,r.c=s,r.a=.5,r.vx=a,r.vy=n,r.dr=.1*Util.w(PILLAR_WIDTH_PER_W)*randF(.5,1.5),r.delta*=randF(.8,1.2),r.setShape(e+a,i+n,r.r,s,r.a),r}return __extends(e,t),e.prototype.setShape=function(t,e,i,o,s){var a=this.display;null==this.display?(this.display=a=new egret.Shape,GameObject.gameDisplay.addChild(this.display)):a.graphics.clear(),a.x=t,a.y=e,a.graphics.lineStyle(8,o,s),a.graphics.drawCircle(0,0,this.r)},e.prototype.update=function(){return this.X+=this.vx,this.Y+=this.vy,this.a-=this.delta,this.r+=this.dr,this.setShape(this.X,this.Y,this.r,this.c,this.a),this.a<=0?void this.destroy():void 0},e}(GameObject);__reflect(EffectCircle.prototype,"EffectCircle");var ScenePlay=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.loadScene=function(){PhysicsObject.deltaScale=1,new Player(Util.w(.3),Util.h(.5)),new Wave(Game.level),new StartMessage,new BackGround,new Score},e.prototype.update=function(){},e}(GameObject);__reflect(ScenePlay.prototype,"ScenePlay");var LevelSelect=!0,SceneTitle=function(t){function e(){var e=t.call(this)||this;e.texts=[],e.startButton=null,e.levelButton=null,e.levelButtonP=null,e.levelButtonM=null,e.settingsButton=null,e.texts[0]=Util.newTextField("糸の冒険",Util.width/12,FONT_COLOR,.5,.25,!0,!1);var i=Util.getSaveDataNumber(SaveKeyBestScore,DefaultBestScore);return e.texts[3]=Util.newTextField("自己ベスト:"+i,Util.width/16,FONT_COLOR,.5,.35,!0,!0),LevelSelect?(e.startButton=new Button("エンドレス",Util.width/16,FONT_COLOR2,.5,.65,.5,.1,FONT_COLOR,1,-1,!0,function(t){return e.onTapStart(t)},e),0==Game.level&&(SDK?Game.level=Social.level+1:Game.level=62),e.levelButton=new Button("レベル"+Game.level,Util.width/16,FONT_COLOR2,.5,.8,.5,.1,FONT_COLOR,1,-1,!0,function(t){return e.onTapLevel(t)},e),e.levelButtonP=new Button("+",Util.width/16,FONT_COLOR2,.85,.8,.1,.07,FONT_COLOR,1,-1,!0,function(t){return e.onTapLevelP(t)},e),e.levelButtonM=new Button("-",Util.width/16,FONT_COLOR2,.15,.8,.1,.07,FONT_COLOR,1,-1,!0,function(t){return e.onTapLevelM(t)},e)):e.startButton=new Button("スタート",Util.width/16,FONT_COLOR2,.5,.65,.6,.1,FONT_COLOR,1,-1,!0,function(t){return e.onTapStart(t)},e),e.texts.forEach(function(t){t&&GameObject.baseDisplay.addChild(t)}),e}return __extends(e,t),e.loadScene=function(){PhysicsObject.deltaScale=1,new Player(Util.w(.3),Util.h(.5)),new BackGround,new Score,new e},e.prototype.onDestroy=function(){this.texts.forEach(function(t){t&&t.parent.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.onTapStart=function(t){GameObject.transit=ScenePlay.loadScene,Game.level=0},e.prototype.onTapLevel=function(t){GameObject.transit=ScenePlay.loadScene},e.prototype.onTapLevelP=function(t){var e=SDK?Social.level+1:999;Game.level=Util.clamp(Game.level+1,1,e),this.levelButton.text.text="レベル"+Game.level},e.prototype.onTapLevelM=function(t){var e=SDK?Social.level+1:999;Game.level=Util.clamp(Game.level-1,1,e),this.levelButton.text.text="レベル"+Game.level},e}(GameObject);__reflect(SceneTitle.prototype,"SceneTitle");var Button=function(t){function e(e,i,o,s,a,n,r,l,h,p,c,y,d,u){void 0===u&&(u=0);var f=t.call(this)||this;return f.text=null,f.onTap=null,f.thisObject=null,f.keyId=0,f.press=!1,f.touch=!1,f.x=0,f.y=0,f.lineRgb=p,f.rgb=l,f.alpha=h,f.xr=s,f.yr=a,f.wr=n,f.hr=r,f.fontSize=i,f.fontRgb=o,f.setDisplay(p,l,h,s,a,n,r),e&&f.setText(e,!0),f.onTap=y,f.thisObject=d,f.keyId=u,f.onTap&&f.display.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){return f.onTap(f)},f.thisObject),f.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,f.touchBegin,f),f.display.addEventListener(egret.TouchEvent.TOUCH_MOVE,f.touchMove,f),f.display.addEventListener(egret.TouchEvent.TOUCH_END,f.touchEnd,f),f
}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;this.onTap&&this.display.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(e){return t.onTap(t)},this.thisObject),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.text&&GameObject.baseDisplay.removeChild(this.text)},e.prototype.setDisplay=function(t,e,i,o,s,a,n){var r=this.display;null==r?(this.display=r=new egret.Shape,GameObject.baseDisplay.addChild(r)):r.graphics.clear(),t>=0?r.graphics.lineStyle(2,t):r.graphics.lineStyle(0),r.graphics.beginFill(e,i);var l=a*Util.width,h=n*Util.height;r.graphics.drawRoundRect(-.5*l,-.5*h,l,h,.4*h),r.graphics.endFill(),r.touchEnabled=!0,r.x=o*Util.width,r.y=s*Util.height,this.display=r},e.prototype.setColor=function(t){this.setDisplay(this.lineRgb,t,this.alpha,this.xr,this.yr,this.wr,this.hr)},e.prototype.setText=function(t,e){if(null==this.text)this.text=Util.newTextField(t,this.fontSize,this.fontRgb,this.xr,this.yr,e,!1),GameObject.baseDisplay.addChild(this.text);else{var i=this.text;this.text.text=t,i.x=Util.width*this.xr-.5*i.width,i.y=Util.height*this.yr-.5*i.height}},e.prototype.setTextColor=function(t){this.text&&(this.text.textColor=t)},e.prototype.update=function(){var t=this.touch?1.1:1;this.display.scaleX=this.display.scaleY=this.display.scaleX+.25*(t-this.display.scaleX),this.press=!1},e.prototype.touchBegin=function(t){this.x=t.stageX,this.y=t.stageY,this.press=!0,this.touch=!0},e.prototype.touchMove=function(t){this.x=t.stageX,this.y=t.stageY,this.touch=!0},e.prototype.touchEnd=function(t){this.touch=!1},e}(GameObject);__reflect(Button.prototype,"Button");var Camera2D=function(){function t(){}return t.initial=function(){t.x=0,t.y=0,t.scale=1},t.transform=function(e,i){void 0===i&&(i=1),e.x=t.transX(e.x),e.y=t.transY(e.y),e.scaleX=e.scaleY=t.scale*i},t.transX=function(e){return(e-t.x)*t.scale},t.transY=function(e){return(e-t.y)*t.scale},t.x=0,t.y=0,t.scale=1,t}();__reflect(Camera2D.prototype,"Camera2D");var EffectFrame=function(t){function e(e,i,o,s,a,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var l=t.call(this)||this;return l.vx=0,l.vy=0,l.delta=.025,l.w=o,l.h=s,l.c=a,l.a=.5,l.vx=n,l.vy=r,l.dw=.1*Util.w(PILLAR_WIDTH_PER_W)*randF(.5,1.5),l.dh=l.dw,l.delta*=randF(.8,1.2),l.setShape(e+n,i+r,l.w,l.h,a,l.a),l}return __extends(e,t),e.prototype.setShape=function(t,e,i,o,s,a){var n=this.display;null==this.display?(this.display=n=new egret.Shape,GameObject.gameDisplay.addChild(this.display)):n.graphics.clear(),n.x=t,n.y=e,n.graphics.lineStyle(8,s,a),n.graphics.drawRect(-.5*i,-.5*o,i,o)},e.prototype.update=function(){return this.X+=this.vx,this.Y+=this.vy,this.a-=this.delta,this.w+=this.dw,this.h+=this.dh,this.setShape(this.X,this.Y,this.w,this.h,this.c,this.a),this.a<=0?void this.destroy():void 0},e}(GameObject);__reflect(EffectFrame.prototype,"EffectFrame");var EffectPopText=function(t){function e(e,i,o,s,a){var n=t.call(this)||this;n.text=null,n.time=60;var r=new egret.TextField;return r.text=e,r.bold=!0,r.size=s,r.textColor=a,r.x=i,r.y=o,r.alpha=.8,n.text=r,GameObject.gameDisplay.addChild(n.text),n}return __extends(e,t),e.prototype.onDestroy=function(){this.text.parent.removeChild(this.text)},e.prototype.update=function(){this.text.y-=.5,this.text.x-=1,this.time--,this.time<=0&&this.destroy()},e}(GameObject);__reflect(EffectPopText.prototype,"EffectPopText");var Random=function(){function t(e){void 0===e&&(e=Math.floor(Math.random()*t.max)),this.x=123456789,this.y=362436069,this.z=521288629,this.w=e}return t.prototype["int"]=function(){return this.next()&t.max},t.prototype.f01=function(){return this["int"]()/(t.max+1)},t.prototype.f=function(t,e){return t+this.f01()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(t){return void 0===t&&(t=.5),this.f01()<t},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.max=1073741823,t}();__reflect(Random.prototype,"Random");var globalRandom=new Random,Sdk=function(){function t(){}return t.loadSdk=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(o){switch(o.label){case 0:return console.log("============================================================"),console.log("Liberapp.loadSdk:"),this.env=this.detectMode(location.origin),console.log("env: ",this.env),t=this.resolveSdkUrl(this.sdkPath),console.log("srcUrl: ",t),[4,this.loadScript(t)];case 1:return e=o.sent(),console.log("script:",e),i=window.LiberappSdk,"egret-wing"!==this.env?[3,3]:[4,i.enableDebug()];case 2:o.sent(),o.label=3;case 3:return console.log("liberappSdk:",i),[2,i]}})})},t.detectMode=function(t){return/^https:\/\/(.+)\.a\.liberapp\.net$/.test(t)?"production":/^https:\/\/(.+)\.a\.staging.\.liberapp\.net$/.test(t)?"staging":/^https:\/\/(.+)\.a\.development\.liberapp\.net$/.test(t)?"development":"egret-wing"},t.resolveSdkUrl=function(t){var e=this.baseUrls[this.env];return""+e+t},t.loadScript=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,i){var o=document.createElement("script");o.async=!1,o.src=t,o.onload=function(){return e(o)},o.onerror=function(){return i(new Error("Can not load script: src:"+t))},document.head.append(o)})]})})},t.baseUrls={production:"https://liberapp.net",staging:"https://staging.liberapp.net",development:"https://localhost","egret-wing":"https://staging.liberapp.net"},t.sdkPath="/dist/sdk/liberapp-ja-0_9.js",t}();__reflect(Sdk.prototype,"Sdk");var Social=function(){function t(){}return t.init=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,o,s,a,n,r,l,h;return __generator(this,function(p){switch(p.label){case 0:return[4,Sdk.loadSdk()];case 1:return t=p.sent(),this.sdk=t,Toast.show({text:"ログイン中・・・",delay:3e4,canHide:!0}),[4,t.initializeAsync()];case 2:return p.sent(),[4,t.startGameAsync()];case 3:return p.sent(),Toast.show({text:this.playerName+"さんようこそ！",delay:3e4,canHide:!0}),e=this,[4,t.getLeaderboardAsync("default")];case 4:return e.leaderboard=p.sent(),[4,Promise.all([this.leaderboard.getEntryCountAsync(),this.leaderboard.getEntriesAsync(3,0),this.leaderboard.getPlayerEntryAsync(),this.sdk.player.getDataAsync(["level"])])];case 5:return i=p.sent(),o=i[0],s=i[1],a=i[2],n=i[3],this.playerEntry=a,this.rawData=n,this.hasBest?Toast.show({text:"今のところ"+o+"人中"+this.bestRank+"位です",delay:3e3}):(r=s[0],r&&(console.log(r),l=r.getPlayer().getName(),h=r.getScore(),Toast.show({text:o+"人が遊んでいます!\n一番は"+l+"さん\nスコアは"+h+"です",delay:3e3}))),[2]}})})},Object.defineProperty(t,"hasBest",{get:function(){return!!this.myBestEntry},enumerable:!0,configurable:!0}),Object.defineProperty(t,"bestScore",{get:function(){return this.hasBest?this.myBestEntry.getScore():0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"bestRank",{get:function(){return this.hasBest?this.myBestEntry.getRank():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"playerEntry",{set:function(e){console.log("myBest:",this.myBestEntry,e),this.myBestEntry=e,Score.bestScore=t.bestScore,Score.bestRank=t.bestRank},enumerable:!0,configurable:!0}),t.setScore=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setScore "+t),Toast.show({text:"ハイスコアを送信中",delay:3e4,canHide:!0}),e=this,[4,this.leaderboard.setScoreAsync(t)];case 1:return e.playerEntry=i.sent(),Toast.show({text:"順位は"+this.bestRank+"位でした",delay:3e3}),[2]}})})},Object.defineProperty(t,"playerName",{get:function(){return this.sdk.player.getName()||"名無し"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"hasData",{get:function(){return!!this.rawData},enumerable:!0,configurable:!0}),Object.defineProperty(t,"level",{get:function(){return this.hasData?this.rawData.level:0},enumerable:!0,configurable:!0}),t.setLevel=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setLevel "+t),Toast.show({text:"達成レベルを送信中",delay:3e4,canHide:!0}),e=this,[4,this.sdk.player.setDataAsync({level:t})];case 1:return e.rawData=i.sent(),Toast.show({text:"送信完了",delay:1500}),[2]}})})},t}();__reflect(Social.prototype,"Social");var Util=function(){function t(){}return t.w=function(e){return e*t.width},t.h=function(e){return e*t.height},t.initial=function(t){this.width=t.stage.stageWidth,this.height=t.stage.stageHeight},t["break"]=function(t,e){t&&console.log(e)},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.clamp01=function(e){return t.clamp(e,0,1)},t.lerp=function(t,e,i){return t+(e-t)*this.clamp01(i)},t.deltaAngle=function(t){var e=(t+Math.PI)/(2*Math.PI);return e=65536*e&65535,e=e/65536*Math.PI*2-Math.PI},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var o=1-i,s=((16711680&t)*o+(16711680&e)*i&16711680)+((65280&t)*o+(65280&e)*i&65280)+((255&t)*o+(255&e)*i&255);return s},t.newTextField=function(e,i,o,s,a,n,r){var l=new egret.TextField;return l.text=e,l.bold=n,l.size=i,l.textColor=o,r?(l.x=(t.width-l.width)*s,l.y=(t.height-l.height)*a):(l.x=t.width*s-.5*l.width,l.y=t.height*a-.5*l.height),l},t.newShadowText=function(t,e,i){void 0===i&&(i=1.5);var o=new egret.TextField;return o.text=t.text,o.bold=t.bold,o.size=t.size,o.textColor=e,o.x=t.x+i,o.y=t.y+i,o.alpha=.5,o},t.newBitmap=function(t,e,i,o){var s=new egret.Bitmap;return s.texture=RES.getRes(t),GameObject.baseDisplay.addChild(s),s.x=e,s.y=i,s.anchorOffsetX=.5*s.width,s.anchorOffsetY=.5*s.height,s.scaleX=s.scaleY=o,s},t.getSaveDataNumber=function(t,e){var i=egret.localStorage.getItem(t),o=e;return null!=i&&(o=parseInt(i)),o},t.setSaveDataNumber=function(t,e){egret.localStorage.setItem(t,""+e)},t.getSaveDataString=function(t,e){var i=egret.localStorage.getItem(t);return null==i&&(i=e),i},t.setSaveDataString=function(t,e){egret.localStorage.setItem(t,e)},t}();__reflect(Util.prototype,"Util");var GameOver=function(t){function e(e){var i=t.call(this)||this;return i.texts=[],i.retryButton=null,i.backButton=null,i.step=0,i.fadeInFrame=64,i.clear=e,i.texts[0]=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/13,FONT_COLOR,.5,.5,!0,!1),egret.Tween.get(i.texts[0],{loop:!1}).to({alpha:0},0).to({alpha:1},1e3),GameObject.gameDisplay.addChild(i.texts[0]),Game.level>0&&i.clear&&(i.texts[1]=Util.newTextField("レベル"+Game.level+"クリア",Util.width/13,FONT_COLOR,.5,.3,!0,!1),GameObject.gameDisplay.addChild(i.texts[1])),SDK&&(0==Game.level?Score.I.point>Score.bestScore&&Social.setScore(Score.I.point):i.clear&&Game.level>Social.level&&Social.setLevel(Game.level)),i}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.gameDisplay.removeChild(t)}),this.texts=null},e.prototype.update=function(){this.step++,this.step==this.fadeInFrame&&(0==Game.level&&(this.retryButton=new Button("リトライ",Util.width/16,Game.bColor(),.5,.75,.4,.1,FONT_COLOR,1,-1,!0,this.onTapRetry,this)),this.backButton=new Button("終了",Util.width/18,Game.bColor(),.1,.1,.2,.075,FONT_COLOR,1,-1,!0,this.onTapBack,this),Score.I.point>Score.bestScore&&0==Game.level&&(this.texts[1]=Util.newTextField("NEW RECORD!",Util.width/13,FONT_COLOR,.5,.4,!0,!1),egret.Tween.get(this.texts[1],{loop:!0}).to({alpha:0},500).to({alpha:1},500),GameObject.gameDisplay.addChild(this.texts[1])))},e.prototype.onTapBack=function(){this.clear&&SDK&&Game.level==Social.level&&Game.level++,GameObject.transit=SceneTitle.loadScene,this.destroy()},e.prototype.onTapRetry=function(){GameObject.transit=ScenePlay.loadScene,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Score=function(t){function e(){var i=t.call(this)||this;return i.point=0,i.combo=0,i.text=null,i.textBest=null,i.textLevel=null,e.I=i,i.point=0,i.text=Util.newTextField("0",Util.width/16,Game.bColor(),.5,0,!0,!0),GameObject.gameDisplay.addChild(i.text),i.textBest=Util.newTextField("BEST:"+e.bestScore,Util.width/24,Game.bColor(),.85,0,!0,!0),GameObject.gameDisplay.addChild(i.textBest),Game.level>0&&(i.textLevel=Util.newTextField("レベル:"+Game.level,Util.width/24,Game.bColor(),.15,0,!0,!0),GameObject.gameDisplay.addChild(i.textLevel)),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.gameDisplay.removeChild(this.text),this.text=null,GameObject.gameDisplay.removeChild(this.textBest),this.textBest=null,this.textLevel&&GameObject.gameDisplay.removeChild(this.textLevel),this.textLevel=null,e.I=null},e.prototype.update=function(){},e.prototype.addPoint=function(t){void 0===t&&(t=1),this.point+=t,this.text.text=""+this.point.toFixed(),e.bestScore<this.point&&(this.textBest.text="BEST:"+this.point.toFixed())},e.prototype.addCombo=function(){this.combo++},e.prototype.resetCombo=function(){this.combo=0},e.I=null,e.bestScore=0,e}(GameObject);__reflect(Score.prototype,"Score");var StartMessage=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.texts[1]=Util.newTextField("タッチ中は上昇",Util.width/19,FONT_COLOR,.5,.35,!0,!1),e.texts[2]=Util.newTextField("ぶつからないように進め",Util.width/19,FONT_COLOR,.5,.4,!0,!1),e.texts.forEach(function(t){GameObject.gameDisplay.addChild(t)}),GameObject.baseDisplay.once(egret.TouchEvent.TOUCH_BEGIN,e.tap,e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.gameDisplay.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.tap=function(t){Player.I.setStateMove(),this.destroy()},e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");var DefaultToastOptions={text:"",delay:3e3,canHide:!1},Toast=function(t){function e(e){var i=t.call(this)||this;return i.queue=[],i.rect=new eui.Rect,i.rect.alpha=0,i.label=new eui.Label,i.label.maxWidth=e,i.rect.addEventListener(eui.UIEvent.CREATION_COMPLETE,i.onRectCreationComplete,i),i.label.addEventListener(eui.UIEvent.RESIZE,i.onLabelResized,i),GameObject.baseDisplay.addChild(i.rect),i}return __extends(e,t),e.prototype.update=function(){},e.show=function(t){var i=__assign({},DefaultToastOptions,t);this.I||(this.I=new e(.6*Util.width)),this.I.show(i)},e.prototype.onDestory=function(){var t=e.I;e.I=void 0,t&&(t.rect.removeChildren(),t.rect=void 0,t.label=void 0)},e.prototype.show=function(t){if(console.log("Toast.show"),this.currentOptions){if(!this.currentOptions.canHide)return void this.queue.push(t);this.currentTween.setPaused(!0),this.currentTween=void 0,this.currentOptions=void 0,this.queue=[]}this.currentOptions=t,this.toastText=t.text,this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:1},300).wait(t.delay).call(this.onStartHide,this)},e.prototype.onStartHide=function(){console.log("Toast.onStartHide"),void 0!==this.currentTween&&(this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:0},300).call(this.onCompleteHide,this))},e.prototype.onCompleteHide=function(){if(console.log("Toast.onCompleteHide"),this.currentTween=void 0,this.currentOptions=void 0,0!==this.queue.length){var t=this.queue.shift();this.show(t)}},e.prototype.onRectCreationComplete=function(){console.log("Toast.onRectCreationComplete"),this.rect.fillColor=0,this.rect.fillAlpha=.6,this.rect.horizontalCenter=0,this.rect.verticalCenter=0,this.rect.ellipseWidth=30,this.rect.ellipseHeight=30,this.label.x=20,this.label.y=20,this.label.size=28,this.rect.addChild(this.label),this.toastText=""},Object.defineProperty(e.prototype,"toastText",{set:function(t){console.log("Toast.toastText:"),this.label.text=t},enumerable:!0,configurable:!0}),e.prototype.onLabelResized=function(){console.log("Toast.onLabelResized:"),this.rect.width=this.label.width+40,this.rect.height=this.label.height+40,this.rect.x=(Util.width-this.rect.width)/2,this.rect.y=(Util.height-this.rect.height)/2},e}(GameObject);__reflect(Toast.prototype,"Toast");